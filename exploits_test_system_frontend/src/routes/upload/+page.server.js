import fs from 'fs/promises'; // Node.js file system module to handle file saving
import path from 'path';

export const actions = {
    submit: async ({ request }) => {
        const formData = await request.formData();

        const repoName = formData.get('repoName'); 
        const authorName = formData.get('authorName'); 
        const websiteLink = formData.get('websiteLink'); 
        const csvFile = formData.get('csvFile'); 

        console.log('Repository Name:', repoName);
        console.log('Author Name:', authorName);
        console.log('Website Link:', websiteLink);

        // Validate inputs
        if (!repoName || !authorName || !websiteLink) {
            return { error: 'Repository name, author name, and website link are required' };
        }

        // Check if file exists
        if (!csvFile || csvFile.size === 0) {
            return { error: 'No file uploaded' };
        }

 
        const uploadPath = path.resolve('uploads', csvFile.name);
        const buffer = await csvFile.arrayBuffer();
        await fs.writeFile(uploadPath, Buffer.from(buffer)); 

        console.log('File saved at:', uploadPath);

        return {
            success: true,
            message: 'Form submitted successfully',
        };
    },
};
