<script>
    import   { HighlightAuto, LineNumbers } from "svelte-highlight";
  import typescript from "svelte-highlight/languages/typescript";
  import ashes from "svelte-highlight/styles/ashes";
//   import { demos_st, codes_st, desc_and_rec_st, rows_st } from '$lib/stores/dataStores.js';

//     let demos = $demos_st;
//     let codes = $codes_st;
//     let desc_and_rec = $desc_and_rec_st;
//     let rows = $rows_st;

//     //console.log(codes[3]);
//     console.log(rows[3]);
//     //console.log(desc_and_rec[1]);
//     console.log(typeof(demos[1]));

let {data} = $props();

let currentVulnerability = data?.currentVulnerability;
	const severityStyles = {
		critical: { color: "bg-red-800", icon: "!!", label: "Critical" },
		high: { color: "bg-red-600", icon: "!", label: "High" },
		medium: { color: "bg-orange-400", icon: "!", label: "Medium" },
		low: { color: "bg-yellow-400", icon: "!", label: "Low" }
	};

	let isOpen = false; // Controls whether the menu is open on mobile

	function toggleMenu() {
		isOpen = !isOpen;
	}
    import { page } from '$app/stores'
    let id;
    id =  $page.url.searchParams.get('id')
</script>
<svelte:head>
  {@html ashes}
</svelte:head>


<header>
	<div class="w-full fixed flex justify-between items-start top-0 h-16 px-4 shadow-md bg-[#060C06] z-50">

		<a href="/" class="flex items-center">
		
			<svg xmlns="http://www.w3.org/2000/svg" width="3em" height="3em" viewBox="0 0 24 24">
				<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 9.25v4m22.5-4v4m-22.5-2h5.5m0-4.013v4.49a7.02 7.02 0 0 0 4.5 6.554l.614.236c.409.157.861.157 1.27 0l.614-.236a7.02 7.02 0 0 0 4.5-6.554v-4.49a.88.88 0 0 0-.512-.8A12.8 12.8 0 0 0 12 5.365a12.8 12.8 0 0 0-5.238 1.068a.88.88 0 0 0-.512.804m11.5 4.013h5.5" />
				<text x="12" y="14" text-anchor="middle" font-weight="bold" font-size="6" fill="currentColor" font-family="Space Grotesk">W</text>
			</svg>
	
			<h2 class="font-heading ml-3 text-white text-xl">
				Web<span class="font-bold text-green-500">Ward</span>
			</h2>
		</a>
        <a href="/analyze" class="flex font-heading items-center justify-center h-12 p-4 w-70 bg-white/10 hover:bg-white/20 text-white rounded-2xl border border-[#5bc401]/30 shadow-md">
			
            <span class="mr-2">Get Personalized TODOs</span>
		
             <div class="w-6 h-6 rounded-full flex justify-center items-center bg-[#060C06]">
                <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24" >
                    <path fill="#5bc401" d="m12 15.577l-3.539-3.538l.708-.72L11.5 13.65V5h1v8.65l2.33-2.33l.709.719zM6.616 19q-.691 0-1.153-.462T5 17.384v-2.423h1v2.423q0 .231.192.424t.423.192h10.77q.23 0 .423-.192t.192-.424v-2.423h1v2.423q0 .691-.462 1.153T17.384 19z" />
                </svg>
        </div>
    </a>
	</div>
</header>
<div class="flex flex-col w-full   lg:mt-36">

    <div class="flex flex-col lg:flex-row w-full ">
 
        <div class="w-full lg:w-[calc(100%-24rem)]">
           
            <div class="grid grid-cols-1 lg:grid-cols-4 lg:grid-rows-4 gap-4 lg:min-h-screen bg-black mr-4 overflow-y-scroll ml-4 ">
             
                <div class="lg:col-span-2 lg:row-span-3 lg:col-start-3 lg:row-start-1 z-40  ">
                    <div class="lg:col-span-2 lg:row-span-2 bg-[#1E1E1E] h-40 rounded-3xl  shadow-md w-full flex items-center justify-center text-lg p-4 mb-4 mt-20 lg:mt-0">
                     
                   
                        <div class="flex flex-row items-center mr-4">
                            <div class="{severityStyles[currentVulnerability.severity].color} h-10 w-10 rounded-full flex items-center justify-center">
                                <div class="h-6 w-6 rounded-full bg-white flex items-center justify-center">
                                    <span class="text-red-500 text-sm font-bold font-heading">{severityStyles[currentVulnerability.severity].icon}</span>
                                </div>
                            </div>
                            <h1 class=" mt-2 text-gray-400 ml-4 font-heading font-bold text-2xl">Severity: {severityStyles[currentVulnerability.severity].label}</h1>
                        </div>
        
                  
                </div>
                <h1 class="mb-4 font-bold">Problematic Code:</h1>
                {#key currentVulnerability}
                <div class="border-2 border-red-600 rounded-3xl overflow-y-scroll h-[500px] w-full">
                    <HighlightAuto code={currentVulnerability.problematic_code} let:highlighted>
                        <LineNumbers {highlighted} hideBorder startingLineNumber={currentVulnerability.line_number}/>
                    </HighlightAuto>
                </div>
                {/key}
                    <div class="flex bg-[#1E1E1E] p-4 rounded-3xl  shadow-md w-full mt-4">
                        <h1 class="font-heading">Path: {currentVulnerability.file_path}</h1>
                    </div>
                
                </div>
      
                

          
                <div class="lg:col-span-2 lg:row-span-2 lg:col-start-1 lg:row-start-1 text-lg pb-6">
                    
                    <div class="lg:col-span-2 lg:row-span-2 flex flex-col justify-start items-start bg-[#1E1E1E] rounded-3xl shadow-md w-full text-lg p-4 mb-4">
                        <h1 class="mb-4 font-bold text-center">Recomendations</h1>
                        <h3 class="mb-4">{currentVulnerability.recomendation}</h3>
                 
                        <h1 class="mb-4 font-bold text-center">Possible Solution:</h1>
                        <!-- Code Preview -->
                        <div class="border-2 border-green-600 rounded-3xl overflow-hidden w-full">
                            <HighlightAuto  code={currentVulnerability.possible_solution} let:highlighted>
                                <LineNumbers {highlighted} hideBorder  />
                            </HighlightAuto>
                        </div>
                    </div>
                

                
              

                    
                  
                </div>
             
                <div class="lg:col-span-4 lg:row-span-2 lg:col-start-1 lg:row-start-3   text-lg ">
                    <div class=" bg-[#1E1E1E]  rounded-3xl  p-4 mt-4">
<h1 class="font-body">{currentVulnerability.description}</h1>                  
  </div>
                    <div class=" bg-[#1E1E1E]  rounded-3xl  p-4 mt-4 ">
                        <h1 class="text-center font-heading text-xl">Live Demo</h1>
                        <h3 class="font-body text-left">{currentVulnerability.live_demo}</h3>
                    </div>
                </div>
                      
            </div>
        </div>
    </div>

</div>




