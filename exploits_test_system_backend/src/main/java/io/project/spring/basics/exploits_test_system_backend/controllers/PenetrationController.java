package io.project.spring.basics.exploits_test_system_backend.controllers;

import io.project.spring.basics.exploits_test_system_backend.services.PenetrationService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.util.Map;

@RestController
@RequestMapping("/penetrate")
public class PenetrationController {
    @Autowired
    PenetrationService penetrationService;

    @PostMapping("")
    public String penetrate() {
        return penetrationService.penetrate("Content: ```json\n" +
                "[\n" +
                "    {\"input\": \"../../etc/passwd\"},\n" +
                "    {\"input\": \"../../var/log/syslog\"},\n" +
                "    {\"input\": \"../../../etc/hosts\"},\n" +
                "    {\"input\": \"../../../../../../tmp/test.txt\"},\n" +
                "    {\"input\": \"/app/restricted/../../secret.txt\"}\n" +
                "]\n" +
                "```", "http://localhost:3000/");
    }

    @PostMapping("/all")
    public Map<Integer, String> penetrateAll(@RequestParam("file") MultipartFile file,
                                             @RequestParam("owner") String owner,
                                             @RequestParam("repo") String repo, @RequestParam("website") String website) throws Exception {
        return penetrationService.penetrateAll(file, owner, repo, website);
    }

    @PostMapping("/get-demo")
    public Map<Integer, String> getDemo(@RequestParam("file") MultipartFile file,
                          @RequestParam("owner") String owner,
                          @RequestParam("repo") String repo, @RequestParam("website") String website) throws Exception {
        return penetrationService.getLiveDemo(file, owner, repo, website);
    }

    @PostMapping("/get_all_data")
    public Map<String, Map<Integer, String>> getAllData(@RequestParam("file") MultipartFile file,
                             @RequestParam("owner") String owner,
                             @RequestParam("repo") String repo, @RequestParam("website") String website) throws Exception {
        return penetrationService.getAllData(file, owner, repo, website);
    }
}
